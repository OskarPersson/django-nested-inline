(function(e){function t(r,i,s,o){var u=e(false);var a=r.replace(/[-][0-9][-]/g,"-0-");var f=e("#"+a+"-group ."+a+"-0-nested-inline").not(".cloned");if(!f.length){f=e("#"+a+"-group ."+a+"-nested-inline").not(".cloned")}f.each(function(f,l){var c=e(this).attr("id").split("-group")[0];var h=c.replace(a+"-0",r+"-"+i);var p=e(l).clone();p.addClass("cloned");if(p.children().first().hasClass("tabular")){p.find(".form-row").not(".empty-form").remove();p.find(".nested-inline-row").remove();template_form=p.find("#"+c+"-empty");new_form=template_form.clone().removeClass(s.emptyCssClass).addClass("dynamic-"+h);new_form.insertBefore(template_form);var d=new_form.find("input");d.each(function(){var t=e(this);if(t.val()){t.removeAttr("value")}});n(p,c,h);p.find("#id_"+h+"-TOTAL_FORMS").val(1);p.find("#id_"+h+"-INITIAL_FORMS").val(0);var v=p.find(".add-row").text();p.find(".add-row").remove();p.find(".tabular.inline-related tbody tr."+h+"-not-nested").tabularFormset({prefix:h,adminStaticPrefix:s.adminStaticPrefix,addText:v,deleteText:s.deleteText});var m=t(h,0,s,false);if(m.length){p.find(".form-row").addClass("no-bottom-border")}m.each(function(){if(!e(this).next()){border_class=""}else{border_class=" no-bottom-border"}p.find("#"+h+"-empty").before(e('<tr class="nested-inline-row'+border_class+'">').html(e("<td>",{colspan:"100%"}).html(e(this))))})}else{var m=t(h,0,s,true);p.find(".inline-related").not(".empty-form").remove();template_form=p.find("#"+c+"-empty");new_form=template_form.clone().removeClass(s.emptyCssClass).addClass("dynamic-"+h);new_form.insertBefore(template_form);var d=new_form.find("input");d.each(function(){var t=e(this);if(t.val()){t.removeAttr("value")}});new_form.find(".inline_label").text("#1");n(p,c,h);p.find("#id_"+h+"-TOTAL_FORMS").val(1);p.find("#id_"+h+"-INITIAL_FORMS").val(0);var v=p.find(".add-row").text();p.find(".add-row").remove();p.find(".inline-related").stackedFormset({prefix:h,adminStaticPrefix:s.adminStaticPrefix,addText:v,deleteText:s.deleteText});m.each(function(){new_form.append(e(this))})}if(o){p=p.add(e('<div class="nested-inline-bottom-border">'))}if(u.length){u=u.add(p)}else{u=p}});return u}function n(t,n,i){t.attr("id",t.attr("id").replace(n,i));t.find("*").each(function(){if(e(this).attr("for")){e(this).attr("for",e(this).attr("for").replace(n,i))}if(e(this).attr("class")){e(this).attr("class",e(this).attr("class").replace(n,i))}if(this.id){this.id=this.id.replace(n,i)}if(this.name){this.name=this.name.replace(n,i)}});prefix_fix=t.find(".inline-related").first();nextIndex=r(i);if(prefix_fix.hasClass("tabular")){prefix_fix=prefix_fix.find(".form-row").first();prefix_fix.attr("id",prefix_fix.attr("id").replace("-empty","-"+nextIndex))}else{prefix_fix.attr("id",prefix_fix.attr("id").replace("-empty","-"+nextIndex))}prefix_fix.find("*").each(function(){if(e(this).attr("for")){e(this).attr("for",e(this).attr("for").replace("__prefix__","0"))}if(e(this).attr("class")){e(this).attr("class",e(this).attr("class").replace("__prefix__","0"))}if(this.id){this.id=this.id.replace("__prefix__","0")}if(this.name){this.name=this.name.replace("__prefix__","0")}})}function r(t){formset_prop=e("#id_"+t+"-TOTAL_FORMS");if(!formset_prop.length){return 0}return parseInt(formset_prop.attr("autocomplete","off").val())}function i(t,n){var i=r(t);if(n){e("#id_"+t+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(i)+1)}else{e("#id_"+t+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(i)-1)}}function s(t){var n=e("#id_"+t+"-MAX_NUM_FORMS").attr("autocomplete","off").val();if(typeof n=="undefined"){return""}return parseInt(n)}e.fn.formset=function(n){var o=e.extend({},e.fn.formset.defaults,n);var u=e(this);var a=u.parent();var f=function(t,n,r){var i=new RegExp("("+n+"-(\\d+|__prefix__))");var s=n+"-"+r;if(e(t).attr("for")){e(t).attr("for",e(t).attr("for").replace(i,s))}if(t.id){t.id=t.id.replace(i,s)}if(t.name){t.name=t.name.replace(i,s)}};var l=r(o.prefix);u.each(function(t){e(this).not("."+o.emptyCssClass).addClass(o.formCssClass)});var c=s(o.prefix)===""||s(o.prefix)-r(o.prefix)>0;if(u.length&&c){var h;if(u.prop("tagName")=="TR"){var p=this.eq(-1).children().length;a.append('<tr class="'+o.addCssClass+'"><td colspan="'+p+'"><a href="javascript:void(0)">'+o.addText+"</a></tr>");h=a.find("tr:last a")}else{u.filter(":last").after('<div class="'+o.addCssClass+'"><a href="javascript:void(0)">'+o.addText+"</a></div>");h=u.filter(":last").next().find("a")}h.click(function(n){n.preventDefault();var u=r(o.prefix);var a=e("#"+o.prefix+"-empty");var l=a.clone(true);l.removeClass(o.emptyCssClass).addClass(o.formCssClass).attr("id",o.prefix+"-"+u);if(l.is("tr")){l.children(":last").append('<div><a class="'+o.deleteCssClass+'" href="javascript:void(0)">'+o.deleteText+"</a></div>")}else if(l.is("ul")||l.is("ol")){l.append('<li><a class="'+o.deleteCssClass+'" href="javascript:void(0)">'+o.deleteText+"</a></li>")}else{l.children(":first").append('<span><a class="'+o.deleteCssClass+'" href="javascript:void(0)">'+o.deleteText+"</a></span>")}l.find("*").each(function(){f(this,o.prefix,u)});l.insertBefore(e(a));i(o.prefix,true);if(s(o.prefix)!==""&&s(o.prefix)-r(o.prefix)<=0){h.parent().hide()}l.find("a."+o.deleteCssClass).click(function(t){t.preventDefault();var n=e(this).parents("."+o.formCssClass);var r=n.parent();while(n.next().hasClass("nested-inline-row")){n.next().remove()}n.remove();i(o.prefix,false);if(o.removed){o.removed(r)}});if(l.is("tr")){nested_formsets=t(o.prefix,u,o,false);if(nested_formsets.length){l.addClass("no-bottom-border")}nested_formsets.each(function(){if(!e(this).next()){border_class=""}else{border_class=" no-bottom-border"}e('<tr class="nested-inline-row'+border_class+'">').html(e("<td>",{colspan:"100%"}).html(e(this))).insertBefore(e(a))})}else{nested_formsets=t(o.prefix,u,o,true);nested_formsets.each(function(){l.append(e(this))})}if(o.added){o.added(l)}u=u+1})}return this};e.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null};e.fn.tabularFormset=function(t){var n=e(this);var r=function(t){row_number=0;e(n.selector).not(".add-row").removeClass("row1 row2").each(function(){e(this).addClass("row"+(row_number%2+1));next=e(this).next();while(next.hasClass("nested-inline-row")){next.addClass("row"+(row_number%2+1));next=next.next()}row_number=row_number+1})};var i=function(){if(typeof DateTimeShortcuts!="undefined"){e(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var s=function(){if(typeof SelectFilter!="undefined"){e(".selectfilter").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],false,t.adminStaticPrefix)});e(".selectfilterstacked").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],true,t.adminStaticPrefix)})}};var o=function(t){t.find(".prepopulated_field").each(function(){var n=e(this),r=n.find("input, select, textarea"),i=r.data("dependency_list")||[],s=[];e.each(i,function(e,n){s.push("#"+t.find(".field-"+n).find("input, select, textarea").attr("id"))});if(s.length){r.prepopulate(s,r.attr("maxlength"))}})};n.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:r,added:function(e){o(e);i();s();r(e)}});return n};e.fn.stackedFormset=function(t){var n=e(this);var r=function(t){t.children(".inline-related").not(".empty-form").children("h3").find(".inline_label").each(function(t){var n=t+1;e(this).html(e(this).html().replace(/(#\d+)/g,"#"+n))})};var i=function(){if(typeof DateTimeShortcuts!="undefined"){e(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var s=function(){if(typeof SelectFilter!="undefined"){e(".selectfilter").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],false,t.adminStaticPrefix)});e(".selectfilterstacked").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],true,t.adminStaticPrefix)})}};var o=function(t){t.find(".prepopulated_field").each(function(){var n=e(this),r=n.find("input, select, textarea"),i=r.data("dependency_list")||[],s=[];e.each(i,function(e,n){s.push("#"+t.find(".form-row .field-"+n).find("input, select, textarea").attr("id"))});if(s.length){r.prepopulate(s,r.attr("maxlength"))}})};n.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:r,added:function(e){o(e);i();s();r(e.parent())}});return n};})(django.jQuery)
