!function(m){function h(d,l,o,f){var c=m(!1),p=d.replace(/[-][0-9][-]/g,"-0-"),e=m("#"+p+"-group ."+p+"-0-nested-inline").not(".cloned");return(e=e.length?e:m("#"+p+"-group ."+p+"-nested-inline").not(".cloned")).each(function(e,t){var i,r,a=m(this).attr("id").split("-group")[0],n=a.replace(p+"-0",d+"-"+l),s=m(t).clone();s.addClass("cloned"),s.children().first().hasClass("tabular")?(s.find(".form-row").not(".empty-form").remove(),s.find(".nested-inline-row").remove(),template_form=s.find("#"+a+"-empty"),(new_form=template_form.clone().removeClass(o.emptyCssClass).addClass("dynamic-"+n)).insertBefore(template_form),new_form.find("input").each(function(){var e=m(this);e.val()&&e.removeAttr("value")}),x(s,a,n),s.find("#id_"+n+"-TOTAL_FORMS").val(1),s.find("#id_"+n+"-INITIAL_FORMS").val(0),r=s.find(".add-row").text(),s.find(".add-row").remove(),s.find(".tabular.inline-related tbody tr."+n+"-not-nested").tabularFormset({prefix:n,adminStaticPrefix:o.adminStaticPrefix,addText:r,deleteText:o.deleteText}),(i=h(n,0,o,!1)).length&&s.find(".form-row").addClass("no-bottom-border"),i.each(function(){border_class=m(this).next()?" no-bottom-border":"",s.find("#"+n+"-empty").before(m('<tr class="nested-inline-row'+border_class+'">').html(m("<td>",{colspan:"100%"}).html(m(this))))})):(i=h(n,0,o,!0),s.find(".inline-related").not(".empty-form").remove(),template_form=s.find("#"+a+"-empty"),(new_form=template_form.clone().removeClass(o.emptyCssClass).addClass("dynamic-"+n)).insertBefore(template_form),new_form.find("input").each(function(){var e=m(this);e.val()&&e.removeAttr("value")}),new_form.find(".inline_label").text("#1"),x(s,a,n),s.find("#id_"+n+"-TOTAL_FORMS").val(1),s.find("#id_"+n+"-INITIAL_FORMS").val(0),r=s.find(".add-row").text(),s.find(".add-row").remove(),s.find(".inline-related").stackedFormset({prefix:n,adminStaticPrefix:o.adminStaticPrefix,addText:r,deleteText:o.deleteText}),i.each(function(){new_form.append(m(this))})),f&&(s=s.add(m('<div class="nested-inline-bottom-border">'))),c=c.length?c.add(s):s}),c}function x(e,t,i){e.attr("id",e.attr("id").replace(t,i)),e.find("*").each(function(){m(this).attr("for")&&m(this).attr("for",m(this).attr("for").replace(t,i)),m(this).attr("class")&&m(this).attr("class",m(this).attr("class").replace(t,i)),this.id&&(this.id=this.id.replace(t,i)),this.name&&(this.name=this.name.replace(t,i))}),prefix_fix=e.find(".inline-related").first(),nextIndex=s(i),(prefix_fix.hasClass("tabular")?prefix_fix=prefix_fix.find(".form-row").first():prefix_fix).attr("id",prefix_fix.attr("id").replace("-empty","-"+nextIndex)),prefix_fix.find("*").each(function(){m(this).attr("for")&&m(this).attr("for",m(this).attr("for").replace("__prefix__","0")),m(this).attr("class")&&m(this).attr("class",m(this).attr("class").replace("__prefix__","0")),this.id&&(this.id=this.id.replace("__prefix__","0")),this.name&&(this.name=this.name.replace("__prefix__","0"))})}function s(e){return(formset_prop=m("#id_"+e+"-TOTAL_FORMS")).length?parseInt(formset_prop.attr("autocomplete","off").val()):0}function d(e,t){var i=s(e);t?m("#id_"+e+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(i)+1):m("#id_"+e+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(i)-1)}function l(e){e=m("#id_"+e+"-MAX_NUM_FORMS").attr("autocomplete","off").val();return void 0===e?"":parseInt(e)}m.fn.formset=function(e){var r,n=m.extend({},m.fn.formset.defaults,e),e=m(this),t=e.parent(),i=(s(n.prefix),e.each(function(e){m(this).not("."+n.emptyCssClass).addClass(n.formCssClass)}),""===l(n.prefix)||0<l(n.prefix)-s(n.prefix));return e.length&&i&&(r="TR"==e.prop("tagName")?(i=this.eq(-1).children().length,t.append('<tr class="'+n.addCssClass+'"><td colspan="'+i+'"><a href="javascript:void(0)">'+n.addText+"</a></tr>"),t.find("tr:last a")):(e.filter(":last").after('<div class="'+n.addCssClass+'"><a href="javascript:void(0)">'+n.addText+"</a></div>"),e.filter(":last").next().find("a"))).click(function(e){e.preventDefault();var a=s(n.prefix),t=m("#"+n.prefix+"-empty"),i=t.clone(!0);i.removeClass(n.emptyCssClass).addClass(n.formCssClass).attr("id",n.prefix+"-"+a),i.is("tr")?i.children(":last").append('<div><a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a></div>"):i.is("ul")||i.is("ol")?i.append('<li><a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a></li>"):i.children(":first").append('<span><a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a></span>"),i.find("*").each(function(){var e,t,i,r;e=this,t=n.prefix,i=a,r=new RegExp("("+t+"-(\\d+|__prefix__))"),t=t+"-"+i,m(e).attr("for")&&m(e).attr("for",m(e).attr("for").replace(r,t)),e.id&&(e.id=e.id.replace(r,t)),e.name&&(e.name=e.name.replace(r,t))}),i.insertBefore(m(t)),d(n.prefix,!0),""!==l(n.prefix)&&l(n.prefix)-s(n.prefix)<=0&&r.parent().hide(),i.find("a."+n.deleteCssClass).click(function(e){e.preventDefault();for(var t=m(this).parents("."+n.formCssClass),e=t.parent();t.next().hasClass("nested-inline-row");)t.next().remove();t.remove(),d(n.prefix,!1),n.removed&&n.removed(e),m(document).trigger("formset:removed",[t,n.prefix])}),i.is("tr")?((nested_formsets=h(n.prefix,a,n,!1)).length&&i.addClass("no-bottom-border"),nested_formsets.each(function(){border_class=m(this).next()?" no-bottom-border":"",m('<tr class="nested-inline-row'+border_class+'">').html(m("<td>",{colspan:"100%"}).html(m(this))).insertBefore(m(t))})):(nested_formsets=h(n.prefix,a,n,!0)).each(function(){i.append(m(this))}),n.added&&n.added(i),a+=1,m(document).trigger("formset:added",[i,n.prefix])}),this},m.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null},m.fn.tabularFormset=function(a){function t(e){row_number=0,m(i.selector).not(".add-row").removeClass("row1 row2").each(function(){for(m(this).addClass("row"+(row_number%2+1)),next=m(this).next();next.hasClass("nested-inline-row");)next.addClass("row"+(row_number%2+1)),next=next.next();row_number+=1})}var i=m(this);return i.formset({prefix:a.prefix,addText:a.addText,formCssClass:"dynamic-"+a.prefix,deleteCssClass:"inline-deletelink",deleteText:a.deleteText,emptyCssClass:"empty-form",removed:t,added:function(e){var r;(r=e).find(".prepopulated_field").each(function(){var e=m(this).find("input, select, textarea"),t=e.data("dependency_list")||[],i=[];m.each(t,function(e,t){i.push("#"+r.find(".field-"+t).find("input, select, textarea").attr("id"))}),i.length&&e.prepopulate(i,e.attr("maxlength"))}),"undefined"!=typeof DateTimeShortcuts&&(m(".datetimeshortcuts").remove(),DateTimeShortcuts.init()),"undefined"!=typeof SelectFilter&&(m(".selectfilter").each(function(e,t){var i=t.name.split("-");SelectFilter.init(t.id,i[i.length-1],!1,a.adminStaticPrefix)}),m(".selectfilterstacked").each(function(e,t){var i=t.name.split("-");SelectFilter.init(t.id,i[i.length-1],!0,a.adminStaticPrefix)})),t()}}),i},m.fn.stackedFormset=function(a){function t(e){e.children(".inline-related").not(".empty-form").children("h3").find(".inline_label").each(function(e){e+=1;m(this).html(m(this).html().replace(/(#\d+)/g,"#"+e))})}var e=m(this);return e.formset({prefix:a.prefix,addText:a.addText,formCssClass:"dynamic-"+a.prefix,deleteCssClass:"inline-deletelink",deleteText:a.deleteText,emptyCssClass:"empty-form",removed:t,added:function(e){var r;(r=e).find(".prepopulated_field").each(function(){var e=m(this).find("input, select, textarea"),t=e.data("dependency_list")||[],i=[];m.each(t,function(e,t){i.push("#"+r.find(".form-row .field-"+t).find("input, select, textarea").attr("id"))}),i.length&&e.prepopulate(i,e.attr("maxlength"))}),"undefined"!=typeof DateTimeShortcuts&&(m(".datetimeshortcuts").remove(),DateTimeShortcuts.init()),"undefined"!=typeof SelectFilter&&(m(".selectfilter").each(function(e,t){var i=t.name.split("-");SelectFilter.init(t.id,i[i.length-1],!1,a.adminStaticPrefix)}),m(".selectfilterstacked").each(function(e,t){var i=t.name.split("-");SelectFilter.init(t.id,i[i.length-1],!0,a.adminStaticPrefix)})),t(e.parent())}}),e}}(django.jQuery);