(function(e){function t(r,i,s,o){var u=e(!1),a=r.replace(/[-][0-9][-]/g,"-0-"),f=e("#"+a+"-group ."+a+"-0-nested-inline").not(".cloned");return f.length||(f=e("#"+a+"-group ."+a+"-nested-inline").not(".cloned")),f.each(function(f,l){var c=e(this).attr("id").split("-group")[0],h=c.replace(a+"-0",r+"-"+i),p=e(l).clone();p.addClass("cloned");if(p.children().first().hasClass("tabular")){p.find(".form-row").not(".empty-form").remove(),p.find(".nested-inline-row").remove(),template_form=p.find("#"+c+"-empty"),new_form=template_form.clone().removeClass(s.emptyCssClass).addClass("dynamic-"+h),new_form.insertBefore(template_form);var d=new_form.find("input");d.each(function(){var t=e(this);t.val()&&t.removeAttr("value")}),n(p,c,h),p.find("#id_"+h+"-TOTAL_FORMS").val(1),p.find("#id_"+h+"-INITIAL_FORMS").val(0);var v=p.find(".add-row").text();p.find(".add-row").remove(),p.find(".tabular.inline-related tbody tr."+h+"-not-nested").tabularFormset({prefix:h,adminStaticPrefix:s.adminStaticPrefix,addText:v,deleteText:s.deleteText});var m=t(h,0,s,!1);m.length&&p.find(".form-row").addClass("no-bottom-border"),m.each(function(){e(this).next()?border_class=" no-bottom-border":border_class="",p.find("#"+h+"-empty").before(e('<tr class="nested-inline-row'+border_class+'">').html(e("<td>",{colspan:"100%"}).html(e(this))))})}else{var m=t(h,0,s,!0);p.find(".inline-related").not(".empty-form").remove(),template_form=p.find("#"+c+"-empty"),new_form=template_form.clone().removeClass(s.emptyCssClass).addClass("dynamic-"+h),new_form.insertBefore(template_form);var d=new_form.find("input");d.each(function(){var t=e(this);t.val()&&t.removeAttr("value")}),new_form.find(".inline_label").text("#1"),n(p,c,h),p.find("#id_"+h+"-TOTAL_FORMS").val(1),p.find("#id_"+h+"-INITIAL_FORMS").val(0);var v=p.find(".add-row").text();p.find(".add-row").remove(),p.find(".inline-related").stackedFormset({prefix:h,adminStaticPrefix:s.adminStaticPrefix,addText:v,deleteText:s.deleteText}),m.each(function(){new_form.append(e(this))})}o&&(p=p.add(e('<div class="nested-inline-bottom-border">'))),u.length?u=u.add(p):u=p}),u}function n(t,n,i){t.attr("id",t.attr("id").replace(n,i)),t.find("*").each(function(){e(this).attr("for")&&e(this).attr("for",e(this).attr("for").replace(n,i)),e(this).attr("class")&&e(this).attr("class",e(this).attr("class").replace(n,i)),this.id&&(this.id=this.id.replace(n,i)),this.name&&(this.name=this.name.replace(n,i))}),prefix_fix=t.find(".inline-related").first(),nextIndex=r(i),prefix_fix.hasClass("tabular")?(prefix_fix=prefix_fix.find(".form-row").first(),prefix_fix.attr("id",prefix_fix.attr("id").replace("-empty","-"+nextIndex))):prefix_fix.attr("id",prefix_fix.attr("id").replace("-empty","-"+nextIndex)),prefix_fix.find("*").each(function(){e(this).attr("for")&&e(this).attr("for",e(this).attr("for").replace("__prefix__","0")),e(this).attr("class")&&e(this).attr("class",e(this).attr("class").replace("__prefix__","0")),this.id&&(this.id=this.id.replace("__prefix__","0")),this.name&&(this.name=this.name.replace("__prefix__","0"))})}function r(t){return formset_prop=e("#id_"+t+"-TOTAL_FORMS"),formset_prop.length?parseInt(formset_prop.attr("autocomplete","off").val()):0}function i(t,n){var i=r(t);n?e("#id_"+t+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(i)+1):e("#id_"+t+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(i)-1)}function s(t){var n=e("#id_"+t+"-MAX_NUM_FORMS").attr("autocomplete","off").val();return typeof n=="undefined"?"":parseInt(n)}e.fn.formset=function(n){var o=e.extend({},e.fn.formset.defaults,n),u=e(this),a=u.parent(),f=function(t,n,r){var i=new RegExp("("+n+"-(\\d+|__prefix__))"),s=n+"-"+r;e(t).attr("for")&&e(t).attr("for",e(t).attr("for").replace(i,s)),t.id&&(t.id=t.id.replace(i,s)),t.name&&(t.name=t.name.replace(i,s))},l=r(o.prefix);u.each(function(t){e(this).not("."+o.emptyCssClass).addClass(o.formCssClass)});var c=s(o.prefix)===""||s(o.prefix)-r(o.prefix)>0;if(u.length&&c){var h;if(u.attr("tagName")=="TR"){var p=this.eq(-1).children().length;a.append('<tr class="'+o.addCssClass+'"><td colspan="'+p+'"><a href="javascript:void(0)">'+o.addText+"</a></tr>"),h=a.find("tr:last a")}else u.filter(":last").after('<div class="'+o.addCssClass+'"><a href="javascript:void(0)">'+o.addText+"</a></div>"),h=u.filter(":last").next().find("a");h.click(function(n){n.preventDefault();var u=r(o.prefix),a=e("#"+o.prefix+"-empty"),l=a.clone(!0);l.removeClass(o.emptyCssClass).addClass(o.formCssClass).attr("id",o.prefix+"-"+u),l.is("tr")?l.children(":last").append('<div><a class="'+o.deleteCssClass+'" href="javascript:void(0)">'+o.deleteText+"</a></div>"):l.is("ul")||l.is("ol")?l.append('<li><a class="'+o.deleteCssClass+'" href="javascript:void(0)">'+o.deleteText+"</a></li>"):l.children(":first").append('<span><a class="'+o.deleteCssClass+'" href="javascript:void(0)">'+o.deleteText+"</a></span>"),l.find("*").each(function(){f(this,o.prefix,u)}),l.insertBefore(e(a)),i(o.prefix,!0),s(o.prefix)!==""&&s(o.prefix)-r(o.prefix)<=0&&h.parent().hide(),l.find("a."+o.deleteCssClass).click(function(t){t.preventDefault();var n=e(this).parents("."+o.formCssClass),r=n.parent();while(n.next().hasClass("nested-inline-row"))n.next().remove();n.remove(),i(o.prefix,!1),o.removed&&(o.removed(r),e(document).trigger("formset:removed",[n,o.prefix]))}),l.is("tr")?(nested_formsets=t(o.prefix,u,o,!1),nested_formsets.length&&l.addClass("no-bottom-border"),nested_formsets.each(function(){e(this).next()?border_class=" no-bottom-border":border_class="",e('<tr class="nested-inline-row'+border_class+'">').html(e("<td>",{colspan:"100%"}).html(e(this))).insertBefore(e(a))})):(nested_formsets=t(o.prefix,u,o,!0),nested_formsets.each(function(){l.append(e(this))})),o.added&&(o.added(l),e(document).trigger("formset:added",[l,o.prefix])),u+=1})}return this},e.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null},e.fn.tabularFormset=function(t){var n=e(this),r=function(t){row_number=0,e(n.selector).not(".add-row").removeClass("row1 row2").each(function(){e(this).addClass("row"+(row_number%2+1)),next=e(this).next();while(next.hasClass("nested-inline-row"))next.addClass("row"+(row_number%2+1)),next=next.next();row_number+=1})},i=function(){typeof DateTimeShortcuts!="undefined"&&(e(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},s=function(){typeof SelectFilter!="undefined"&&(e(".selectfilter").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],!1,t.adminStaticPrefix)}),e(".selectfilterstacked").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],!0,t.adminStaticPrefix)}))},o=function(t){t.find(".prepopulated_field").each(function(){var n=e(this),r=n.find("input, select, textarea"),i=r.data("dependency_list")||[],s=[];e.each(i,function(e,n){s.push("#"+t.find(".field-"+n).find("input, select, textarea").attr("id"))}),s.length&&r.prepopulate(s,r.attr("maxlength"))})};return n.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:r,added:function(e){o(e),i(),s(),r(e)}}),n},e.fn.stackedFormset=function(t){var n=e(this),r=function(t){t.children(".inline-related").not(".empty-form").children("h3").find(".inline_label").each(function(t){var n=t+1;e(this).html(e(this).html().replace(/(#\d+)/g,"#"+n))})},i=function(){typeof DateTimeShortcuts!="undefined"&&(e(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},s=function(){typeof SelectFilter!="undefined"&&(e(".selectfilter").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],!1,t.adminStaticPrefix)}),e(".selectfilterstacked").each(function(e,n){var r=n.name.split("-");SelectFilter.init(n.id,r[r.length-1],!0,t.adminStaticPrefix)}))},o=function(t){t.find(".prepopulated_field").each(function(){var n=e(this),r=n.find("input, select, textarea"),i=r.data("dependency_list")||[],s=[];e.each(i,function(e,n){s.push("#"+t.find(".form-row .field-"+n).find("input, select, textarea").attr("id"))}),s.length&&r.prepopulate(s,r.attr("maxlength"))})};return n.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:r,added:function(e){o(e),i(),s(),r(e.parent())}}),n}})(django.jQuery);