!function(e){function t(r,a,n,s){var d=e(!1),l=r.replace(/[-][0-9][-]/g,"-0-"),f=e("#"+l+"-group ."+l+"-0-nested-inline").not(".cloned")
return f.length||(f=e("#"+l+"-group ."+l+"-nested-inline").not(".cloned")),f.each(function(f,o){var c=e(this).attr("id").split("-group")[0],p=c.replace(l+"-0",r+"-"+a),m=e(o).clone()
if(m.addClass("cloned"),m.children().first().hasClass("tabular")){m.find(".form-row").not(".empty-form").remove(),m.find(".nested-inline-row").remove(),template_form=m.find("#"+c+"-empty"),new_form=template_form.clone().removeClass(n.emptyCssClass).addClass("dynamic-"+p),new_form.insertBefore(template_form)
var h=new_form.find("input")
h.each(function(){var t=e(this)
t.val()&&t.removeAttr("value")}),i(m,c,p),m.find("#id_"+p+"-TOTAL_FORMS").val(1),m.find("#id_"+p+"-INITIAL_FORMS").val(0)
var x=m.find(".add-row").text()
m.find(".add-row").remove(),m.find(".tabular.inline-related tbody tr."+p+"-not-nested").tabularFormset({prefix:p,adminStaticPrefix:n.adminStaticPrefix,addText:x,deleteText:n.deleteText})
var u=t(p,0,n,!1)
u.length&&m.find(".form-row").addClass("no-bottom-border"),u.each(function(){e(this).next()?border_class=" no-bottom-border":border_class="",m.find("#"+p+"-empty").before(e('<tr class="nested-inline-row'+border_class+'">').html(e("<td>",{colspan:"100%"}).html(e(this))))})}else{var u=t(p,0,n,!0)
m.find(".inline-related").not(".empty-form").remove(),template_form=m.find("#"+c+"-empty"),new_form=template_form.clone().removeClass(n.emptyCssClass).addClass("dynamic-"+p),new_form.insertBefore(template_form)
var h=new_form.find("input")
h.each(function(){var t=e(this)
t.val()&&t.removeAttr("value")}),new_form.find(".inline_label").text("#1"),i(m,c,p),m.find("#id_"+p+"-TOTAL_FORMS").val(1),m.find("#id_"+p+"-INITIAL_FORMS").val(0)
var x=m.find(".add-row").text()
m.find(".add-row").remove(),m.find(".inline-related").stackedFormset({prefix:p,adminStaticPrefix:n.adminStaticPrefix,addText:x,deleteText:n.deleteText}),u.each(function(){new_form.append(e(this))})}s&&(m=m.add(e('<div class="nested-inline-bottom-border">'))),d=d.length?d.add(m):m}),d}function i(t,i,a){t.attr("id",t.attr("id").replace(i,a)),t.find("*").each(function(){e(this).attr("for")&&e(this).attr("for",e(this).attr("for").replace(i,a)),e(this).attr("class")&&e(this).attr("class",e(this).attr("class").replace(i,a)),this.id&&(this.id=this.id.replace(i,a)),this.name&&(this.name=this.name.replace(i,a))}),prefix_fix=t.find(".inline-related").first(),nextIndex=r(a),prefix_fix.hasClass("tabular")?(prefix_fix=prefix_fix.find(".form-row").first(),prefix_fix.attr("id",prefix_fix.attr("id").replace("-empty","-"+nextIndex))):prefix_fix.attr("id",prefix_fix.attr("id").replace("-empty","-"+nextIndex)),prefix_fix.find("*").each(function(){e(this).attr("for")&&e(this).attr("for",e(this).attr("for").replace("__prefix__","0")),e(this).attr("class")&&e(this).attr("class",e(this).attr("class").replace("__prefix__","0")),this.id&&(this.id=this.id.replace("__prefix__","0")),this.name&&(this.name=this.name.replace("__prefix__","0"))})}function r(t){return formset_prop=e("#id_"+t+"-TOTAL_FORMS"),formset_prop.length?parseInt(formset_prop.attr("autocomplete","off").val()):0}function a(t,i){var a=r(t)
i?e("#id_"+t+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(a)+1):e("#id_"+t+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(a)-1)}function n(t){var i=e("#id_"+t+"-MAX_NUM_FORMS").attr("autocomplete","off").val()
return void 0===i?"":parseInt(i)}e.fn.formset=function(i){var s=e.extend({},e.fn.formset.defaults,i),d=e(this),l=d.parent(),f=function(t,i,r){var a=RegExp("("+i+"-(\\d+|__prefix__))"),n=i+"-"+r
e(t).attr("for")&&e(t).attr("for",e(t).attr("for").replace(a,n)),t.id&&(t.id=t.id.replace(a,n)),t.name&&(t.name=t.name.replace(a,n))}
r(s.prefix)
d.each(function(t){e(this).not("."+s.emptyCssClass).addClass(s.formCssClass)})
var o=""===n(s.prefix)||n(s.prefix)-r(s.prefix)>0
if(d.length&&o){var c
if("TR"==d.attr("tagName")){var p=this.eq(-1).children().length
l.append('<tr class="'+s.addCssClass+'"><td colspan="'+p+'"><a href="javascript:void(0)">'+s.addText+"</a></tr>"),c=l.find("tr:last a")}else d.filter(":last").after('<div class="'+s.addCssClass+'"><a href="javascript:void(0)">'+s.addText+"</a></div>"),c=d.filter(":last").next().find("a")
c.click(function(i){i.preventDefault()
var d=r(s.prefix),l=e("#"+s.prefix+"-empty"),o=l.clone(!0)
o.find("input:hidden").removeAttr("value"),o.removeClass(s.emptyCssClass).addClass(s.formCssClass).attr("id",s.prefix+"-"+d),o.is("tr")?o.children(":last").append('<div><a class="'+s.deleteCssClass+'" href="javascript:void(0)">'+s.deleteText+"</a></div>"):o.is("ul")||o.is("ol")?o.append('<li><a class="'+s.deleteCssClass+'" href="javascript:void(0)">'+s.deleteText+"</a></li>"):o.children(":first").append('<span><a class="'+s.deleteCssClass+'" href="javascript:void(0)">'+s.deleteText+"</a></span>"),o.find("*").each(function(){f(this,s.prefix,d)}),o.insertBefore(e(l)),a(s.prefix,!0),""!==n(s.prefix)&&n(s.prefix)-r(s.prefix)<=0&&c.parent().hide(),o.find("a."+s.deleteCssClass).click(function(t){t.preventDefault()
for(var i=e(this).parents("."+s.formCssClass),r=i.parent();i.next().hasClass("nested-inline-row");)i.next().remove()
i.remove(),a(s.prefix,!1),s.removed&&s.removed(r)}),o.is("tr")?(nested_formsets=t(s.prefix,d,s,!1),nested_formsets.length&&o.addClass("no-bottom-border"),nested_formsets.each(function(){e(this).next()?border_class=" no-bottom-border":border_class="",e('<tr class="nested-inline-row'+border_class+'">').html(e("<td>",{colspan:"100%"}).html(e(this))).insertBefore(e(l))})):(nested_formsets=t(s.prefix,d,s,!0),nested_formsets.each(function(){o.append(e(this))})),s.added&&s.added(o),d+=1})}return this},e.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null},e.fn.tabularFormset=function(t){var i=e(this),r=function(t){row_number=0,e(i.selector).not(".add-row").removeClass("row1 row2").each(function(){for(e(this).addClass("row"+(row_number%2+1)),next=e(this).next();next.hasClass("nested-inline-row");)next.addClass("row"+(row_number%2+1)),next=next.next()
row_number+=1})},a=function(){"undefined"!=typeof DateTimeShortcuts&&(e(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},n=function(){"undefined"!=typeof SelectFilter&&(e(".selectfilter").each(function(e,i){var r=i.name.split("-")
SelectFilter.init(i.id,r[r.length-1],!1,t.adminStaticPrefix)}),e(".selectfilterstacked").each(function(e,i){var r=i.name.split("-")
SelectFilter.init(i.id,r[r.length-1],!0,t.adminStaticPrefix)}))},s=function(t){t.find(".prepopulated_field").each(function(){var i=e(this),r=i.find("input, select, textarea"),a=r.data("dependency_list")||[],n=[]
e.each(a,function(e,i){n.push("#"+t.find(".field-"+i).find("input, select, textarea").attr("id"))}),n.length&&r.prepopulate(n,r.attr("maxlength"))})}
return i.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:r,added:function(e){s(e),a(),n(),r(e)}}),i},e.fn.stackedFormset=function(t){var i=e(this),r=function(t){t.children(".inline-related").not(".empty-form").children("h3").find(".inline_label").each(function(t){var i=t+1
e(this).html(e(this).html().replace(/(#\d+)/g,"#"+i))})},a=function(){"undefined"!=typeof DateTimeShortcuts&&(e(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},n=function(){"undefined"!=typeof SelectFilter&&(e(".selectfilter").each(function(e,i){var r=i.name.split("-")
SelectFilter.init(i.id,r[r.length-1],!1,t.adminStaticPrefix)}),e(".selectfilterstacked").each(function(e,i){var r=i.name.split("-")
SelectFilter.init(i.id,r[r.length-1],!0,t.adminStaticPrefix)}))},s=function(t){t.find(".prepopulated_field").each(function(){var i=e(this),r=i.find("input, select, textarea"),a=r.data("dependency_list")||[],n=[]
e.each(a,function(e,i){n.push("#"+t.find(".form-row .field-"+i).find("input, select, textarea").attr("id"))}),n.length&&r.prepopulate(n,r.attr("maxlength"))})}
return i.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:r,added:function(e){s(e),a(),n(),r(e.parent())}}),i}}(django.jQuery)
